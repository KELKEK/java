<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<style>
tr:nth-child(even){
	background-color : lightsalmon;
}
tr:nth-child(odd){
	background-color : bisque;
}

#first{
	background-color : yellowgreen;
}

#bithumb{
	border : 1px solid black;
} 

</style>
<script type="text/javascript" src="https://code.jquery.com/jquery-3.1.0.js"></script>
<script>
$(function(){
	$("button:nth-of-type(1)").on("click",f1);
	$("button:nth-of-type(2)").on("click",f2);
	$("button:nth-of-type(3)").on("click",f3);
	$("button:nth-of-type(4)").on("click",f4);
	$("button:nth-of-type(5)").on("click",f5);
	$("button:nth-of-type(6)").on("click",f6);
	$("button:nth-of-type(7)").on("click",f7);
	$("button:nth-of-type(8)").on("click",f8);
	$("button:nth-of-type(9)").on("click",f9);
	$("button:nth-of-type(10)").on("click",f10);
});

function f10(){
	const options = {method: 'GET', headers: {accept: 'application/json'}};

	fetch('https://api.bithumb.com/public/ticker/ALL_KRW', options)
	  .then(response =>{ return response.json();})
	  .then(response => {
	  		var output = `<table id ="bithumb">
	  						<tr id="first">
	  						<td>종목이름</td>
	  						<td>acc_trade_value</td>
	  						<td>acc_trade_value_24H</td>
	  						<td>closing_price</td>
	  						<td>fluctate_24H</td>
	  						<td>fluctate_rate_24H</td>
	  						<td>max_price</td>
	  						<td>min_price</td>
	  						<td>opening_price</td>
	  						<td>prev_closing_price</td>
	  						<td>units_traded</td>
	  						<td>units_traded_24H</td>
	  					</tr>`
	  		for(let 종목 in response.data){
	  			if(종목=='date'){
	  				output += "</table>";
	  				continue;
	  			}
	  			output += `
	  						<tr>
	  						<td>${종목}</td>`;
	  			for(let key in response.data[종목]){
	  				output += `<td>${response.data[종목][key]}</td>`;
	  			}
	  			output += "</tr>";
	  		}
	  		output += "</table>";
	  		$("#here").html(output);
	  })
	  .catch(err => console.error(err));
}


function f9(){
	$.getScript("external.js",function(response){
		console.log(response);
		call();
	});
}

function f8(){
	var data = {"empid":$("#empid").val()};
	var callbackMethod = function(result){
		var obj = JSON.parse(result);
		$("#here").html(obj.이름);
	}
	$.get("empDetail2.jsp",data,callbackMethod);
}

function f7(){
	//현재 view가 그대로 있고 서버에 다녀온다.
	//회원가입 중복체크의 경우 화면이 새로고침되면 안되니
	$.ajax({
		//url:"empDetail.jsp?empid="+$("#empid").val(), //로 한번에 url,data 바로줄수도 있음
		url: "empDetail2.jsp",
		type:"get",
		data:{"empid":$("#empid").val()}, //보내는data
		success:function(result,status,xhr){
			//$("#here").html(result); //받은 값
			var obj = JSON.parse(result);
			$("#here").html(obj.이름);			
		},
		error:function(xhr,status,error){
			console.log("다시해보십셔")
			
		}
	});
}

function f6(){
	$("#here").load("11-17.html");
}

function f5(){
	var xhr = new XMLHttpRequest();
	xhr.onreadystatechange = function(){
		console.log(xhr.responseText);
		var obj = JSON.parse(xhr.responseText);
		var arr = obj.emplist;
		var output="";
		$.each(arr, function(index, item){
			output += `<tr><td>${item.no}</td>
				<td>${item.name}</td>
				<td>${item.capital}</td>
				<td>${item.region}</td></tr>`;
		})
		$("#data-table").html(output);
	};
	xhr.open("get","emplist2.jsp", true);
	xhr.send();
}

function f4(){
	var xhr = new XMLHttpRequest();
	xhr.onreadystatechange = function(){
		$("#data-table").html(xhr.responseText);
	};
	xhr.open("get","emplist.jsp", true);
	xhr.send();
}

function f3(){
	var xhr = new XMLHttpRequest();
	xhr.onreadystatechange = function(){
		//서버로 전송하기전, 후를 체크하여 원하는 data를 받을수 있다.
		console.log(xhr.readyState);
		console.log(xhr.status);
		if(xhr.readyState==4 && xhr.status==200){
			var obj = JSON.parse(xhr.responseText); //이름얻으려면 JSON파싱필요!
			var arr = obj.nations;
			var output="";
			
			$.each(arr, function(index, item){
				console.log(item);
				output += `<tr><td>${item.no}</td>
								<td>${item.name}</td>
								<td>${item.capital}</td>
								<td>${item.region}</td></tr>`;
			});
			
			$("#data-table").html(output);	
		}else if(xhr.status==404){
			$("#here").html("존재하지 않는 페이지입니다.");				
		}
	};
	xhr.open("get","data.json"); //비동기
	xhr.send();		
}

function f2(){
	var xhr = new XMLHttpRequest();
	xhr.onreadystatechange = function(){
		//서버로 전송하기전, 후를 체크하여 원하는 data를 받을수 있다.
		console.log(xhr.readyState);
		if(xhr.readyState==4 && xhr.status==200){
			var s = $("#here").html();
			$("#here").html(s + xhr.responseText);	
		}else if(xhr.status==404){
			$("#here").html("존재하지 않는 페이지입니다.");				
		}
	};
	xhr.open("get","11-17.html"); //default가 비동기
	xhr.send();
	$("#here").html("------------<hr>");			
}

function f1(){
	var xhr = new XMLHttpRequest();
	xhr.open("get","11-17.html",false); //false->동기 true->비동기
	xhr.send(); //동기이면 요청하고 응답이 올때까지 기다린다.
	//비동기이면 서버에서의 응답을 기다리지않고 아래 문장으로 이동한다. 응답을 못 받을수 있다.
	//alert(xhr.responseText);
	console.log(xhr.responseText);
	$("#here").html(xhr.responseText);
}
</script>
</head>
<body>
<h1>Ajax연습</h1>
<input id="empid" value="100">
<button>js이용1(동기통신)</button>
<button>js이용2(비동기통신)</button>
<button>js이용3(비동기통신 JSON)</button>
<button>js이용4(JSP)</button>
<button>js이용5(JSON)</button>
<button>jQuery이용(load)</button>
<button>jQuery이용(ajax)</button>
<button>jQuery이용(get/post)</button>
<button>jQuery이용(javascript가져오기)</button>
<button>jQuery이용(fetch)</button>
<hr>
<div id="here">
<table border="1">
	<thead>
		<tr><th>no</th><th>name</th><th>capital</th><th>region</th></tr>
	</thead>
	<tbody id="data-table">

	</tbody>
</table>
</div>
<div id="here2">
<table border = "1" id = "table">

</table>
</div>
</body>
</html>